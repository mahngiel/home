<VirtualHost *:80>

    ServerAdmin mahngiel.dev
    DocumentRoot "/Web/Home/public"
    DirectoryIndex index.php
    ServerName mahngiel.dev

    LogFormat "%t %>s %l %h %l \"%{Referer}i\" \"%{User-agent}i\"" custom
    CustomLog /var/log/apache2/mahngiel.log custom
    ErrorLog /var/log/apache2/mahngiel.error.log

    <Directory "/Web/Home/public">
        AllowOverride All
	    Order allow,deny
	    allow from all
	    Require all granted
    </Directory>

    <IfModule mod_fastcgi.c>
        AddHandler php5-fcgi .php
        Action php5-fcgi /php5-fcgi
        Alias /php5-fcgi /usr/lib/cgi-bin/php5-fcgi
        FastCgiExternalServer /usr/lib/cgi-bin/php5-fcgi -socket /var/run/php5-fpm.sock -pass-header Authorization
    </IfModule>

    <IfModule mod_rewrite.c>

        <Directory "/Web/Home/">
            RewriteEngine on
            RewriteRule  ^$ public/    [L]
            RewriteRule  ((?s).*) public/$1 [L]
        </Directory>

        <Directory "/Web/Home/public">
            RewriteEngine On
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteRule ^((?s).*)$ index.php?_url=/$1 [QSA,L]
        </Directory>

    </IfModule>
</VirtualHost>
